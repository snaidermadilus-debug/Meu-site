<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cobrinha Mobile</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
</head>
<body>
<script>
let snake = [];
let food;
let dir = {x: 1, y: 0};
let size = 20;
let score = 0;
let record = 0;
let showSniper = false;
let sniperTimer = 0;
let gameOver = false;

let touchStartX = 0;
let touchStartY = 0;

// sons
let eatSound;
let gameOverSound;
let bgMusic;

function preload() {
  eatSound = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
  gameOverSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

  // ðŸŽµ MÃšSICA DE FUNDO (ESCOLHIDA PRA VOCÃŠ)
  bgMusic = new Audio("https://actions.google.com/sounds/v1/ambiences/warehouse_background.ogg");
  bgMusic.loop = true;
  bgMusic.volume = 0.4;
}

function setup() {
  createCanvas(400, 400);
  frameRate(8);

  let saved = localStorage.getItem("recorde_cobrinha");
  if (saved) record = int(saved);

  resetGame();
}

function resetGame() {
  snake = [createVector(200, 200)];
  dir = {x: 1, y: 0};
  score = 0;
  showSniper = false;
  gameOver = false;
  spawnFood();
  loop();
  bgMusic.play();
}

function draw() {
  if (gameOver) return;

  background(0);

  let head = snake[0].copy();
  head.x += dir.x * size;
  head.y += dir.y * size;

  if (head.x < 0 || head.x >= width || head.y < 0 || head.y >= height) {
    endGame();
    return;
  }

  for (let p of snake) {
    if (p.equals(head)) {
      endGame();
      return;
    }
  }

  snake.unshift(head);

  if (head.equals(food)) {
    score++;
    eatSound.play();

    if (score > record) {
      record = score;
      localStorage.setItem("recorde_cobrinha", record);
    }

    spawnFood();

    if (score === 20) {
      showSniper = true;
      sniperTimer = 60;
    }
  } else {
    snake.pop();
  }

  fill(0, 255, 0);
  for (let p of snake) rect(p.x, p.y, size, size);

  fill(255, 0, 0);
  rect(food.x, food.y, size, size);

  fill(255);
  textSize(16);
  text("MaÃ§Ã£s: " + score, 10, 20);
  text("Recorde: " + record, 10, 40);

  if (showSniper) {
    fill(255, 255, 0);
    textSize(36);
    textAlign(CENTER, CENTER);
    text("SNIPER", width / 2, height / 2);
    sniperTimer--;
    if (sniperTimer <= 0) showSniper = false;
  }
}

// CONTROLE TOUCH
function touchStarted() {
  if (gameOver) {
    resetGame();
    return false;
  }
  touchStartX = mouseX;
  touchStartY = mouseY;
  return false;
}

function touchEnded() {
  let dx = mouseX - touchStartX;
  let dy = mouseY - touchStartY;

  if (abs(dx) > abs(dy)) {
    if (dx > 0 && dir.x !== -1) dir = {x: 1, y: 0};
    else if (dx < 0 && dir.x !== 1) dir = {x: -1, y: 0};
  } else {
    if (dy > 0 && dir.y !== -1) dir = {x: 0, y: 1};
    else if (dy < 0 && dir.y !== 1) dir = {x: 0, y: -1};
  }
  return false;
}

function spawnFood() {
  let cols = width / size;
  let rows = height / size;
  food = createVector(
    floor(random(cols)) * size,
    floor(random(rows)) * size
  );
}

function endGame() {
  gameOver = true;
  noLoop();
  bgMusic.pause();
  gameOverSound.play();

  background(0);
  fill(255, 0, 0);
  textSize(30);
  textAlign(CENTER, CENTER);
  text("GAME OVER", width / 2, height / 2);
  textSize(16);
  text("Toque para reiniciar", width / 2, height / 2 + 40);
}
</script>
</body>
</html>
